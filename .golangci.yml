run:
  timeout: 10m
  issues-exit-code: 1
  tests: true
  modules-download-mode: readonly
  allow-parallel-runners: true

output:
  format: colored-line-number
  print-issued-lines: true
  print-linter-name: true
  sort-results: true

linters:
  enable:
    # Enabled by default
    - errcheck      # Check for unchecked errors
    - gosimple      # Simplify code
    - govet         # Official Go static analyzer
    - ineffassign   # Detect ineffectual assignments
    - staticcheck   # Advanced Go linter
    - typecheck     # Type checking
    - unused        # Check for unused code

    # Additional enabled
    - bodyclose     # Check HTTP response body is closed
    - dupl          # Code clone detection
    - gocognit      # Compute cognitive complexity
    - goconst       # Find repeated strings that could be constants
    - gocyclo       # Compute cyclomatic complexity
    - gofmt         # Check code is formatted
    - goimports     # Check imports are formatted
    - gosec         # Inspect for security problems
    - misspell      # Check for misspelled English words
    - nolintlint    # Validate //nolint directives
    - prealloc      # Find slice declarations with non-zero initial length
    - revive        # Fast, configurable, extensible, flexible linter
    - unconvert     # Remove unnecessary type conversions
    - unparam       # Check for unused function parameters
    - whitespace    # Check for unnecessary newlines

    # Best practices
    - errname       # Check error names
    - errorlint     # Find code that shadows errors
    - exportloopref # Check for pointers to loop variables
    - forcetypeassert # Find forced type assertions
    - gocritic      # Comprehensive Go linter
    - godot         # Check comments end in a period
    - gofumpt       # Stricter gofmt
    - gomoddirectives # Check go.mod directives
    - gomodguard    # Check blocked modules
    - goprintffuncname # Check printf-like function names
    - grouper       # Analyze expression groups
    - importas      # Check import naming
    - makezero      # Find slice declarations with non-zero initial length
    - nakedret      # Check naked returns in long functions
    - nilerr        # Find code returning nil with non-nil error
    - nilnil        # Check returning nil and nil
    - noctx         # Find HTTP requests without context
    - nosprintfhostport # Check for sprintf with host:port
    - predeclared   # Check for predeclared identifiers
    - promlinter    # Check Prometheus metrics
    - reassign      # Check for reassigned variables
    - stylecheck    # Stylecheck is a replacement for golint
    - tenv          # Check t.Setenv instead of os.Setenv
    - testableexamples # Check for testable examples
    - thelper       # Check test helpers
    - tparallel     # Check for t.Parallel()
    - usestdlibvars # Check for use of stdlib vars
    - wastedassign  # Find wasted assignment statements

  disable:
    - exhaustruct   # Too strict
    - funlen        # Function length (covered by gocyclo)
    - gochecknoglobals # Sometimes globals are needed
    - gochecknoinits # Init functions are sometimes needed
    - godox         # Don't block on TODOs
    - gomnd         # Magic number detection (too noisy)
    - lll           # Line length (not critical)
    - nlreturn      # Too opinionated
    - paralleltest  # Not always applicable
    - tagliatelle   # Tag formatting (too strict)
    - varnamelen    # Variable name length (too strict)
    - wrapcheck     # Error wrapping (too strict)
    - wsl           # Whitespace linter (too opinionated)

linters-settings:
  errcheck:
    check-type-assertions: true
    check-blank: true

  govet:
    check-shadowing: true
    enable-all: true

  gocyclo:
    min-complexity: 15

  gocognit:
    min-complexity: 20

  dupl:
    threshold: 100

  goconst:
    min-len: 3
    min-occurrences: 3

  gocritic:
    enabled-tags:
      - diagnostic
      - experimental
      - opinionated
      - performance
      - style

  gofumpt:
    extra-rules: true

  misspell:
    locale: US

  nolintlint:
    require-explanation: true
    require-specific: true

  revive:
    rules:
      - name: exported
        arguments:
          - "checkPrivateReceivers"
          - "sayRepetitiveInsteadOfStutters"

  stylecheck:
    checks: ["all", "-ST1000", "-ST1003", "-ST1016", "-ST1020", "-ST1021", "-ST1022"]

  gosec:
    excludes:
      - G404 # Use of weak random number generator (math/rand)
    severity: medium
    confidence: medium

issues:
  exclude-rules:
    # Exclude some linters from running on tests files
    - path: _test\.go
      linters:
        - gocyclo
        - errcheck
        - dupl
        - gosec
        - goconst

    # Exclude some staticcheck messages
    - linters:
        - staticcheck
      text: "SA9003:"

    # Exclude lll issues for long lines with go:generate
    - linters:
        - lll
      source: "^//go:generate "

  max-issues-per-linter: 0
  max-same-issues: 0
  new: false
  fix: false
